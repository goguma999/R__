5. 히스토그램 그래프

### ※ 히스토그램 그래프와 막대그래프와의 차이는 무엇인가 ?

- 막대 그래프 ? 개별 항목의 수량이나 빈도를 비교할 때 사용됩니다.
- 히스토그램 그래프 ? 연속형 데이터의 분포를 시각화 할 때 사용됩니다.
    
    데이터의 분포를 한눈에 파악하기 유용합니다.
    
    ex. 시험 점수 분포 
    

### 📍문법1. R함수_히스토그램 그래프 그리기_[날씨 데이터](https://cafe.daum.net/oracleoracle/Soei/32)

```sql
#1. 데이터를 불러옵니다.
setwd("c:\\data")
weather <- read.csv("weather.csv", header=TRUE, fileEncoding="euc-kr")
head(weather)
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/385e373f-9af1-4159-b217-317f3f3f7628/Untitled.png)

```sql
#2. 데이터를 살펴봅니다.
nrow(weather) #472
ncol(weather) #8
str(weather) 

#3. 시각화할 데이터를 선택합니다.
ahot <- weather$평균기온
ahot

#4. 평균기온 데이터를 히스토그램 그래프로 시각화해서 데이터의 분포를 확인합니다.
histo<- hist(ahot)
histo
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/e60821f6-963b-4beb-a54c-a50edf1492c8/Untitled.png)

```r
#5. 간격조정(breaks 옵션을 사용)
histo4<- hist(ahot, breaks=24)
histo4

histo5<-hist(ahot, breaks=seq(10,4,by=1))
histo5
```

![histo4](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/3c579c0e-75a0-47df-972b-46b1a9d6035d/Untitled.png)

histo4

![histo5](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/62df6ba8-c162-4ab5-9bf2-068f94eda661/Untitled.png)

histo5

그래프 해석:  x축이 평균기온 값(10도~40도 사이) 

                   y축이 각 구간에 해당하는 빈도수

대부분의 데이터가 24도에서 29도 사이에 집중되어 있습니다. 

가장 빈도가 높은 구간이 약 26도에서 27도 사이로 보이며 이 구간에서 약 100개의 데이터 포인트가 존재합니다. 

15도 이하와 30도 이상의 구간에서는 데이터 포인트가 거의 없습니다.  

왜도(skewness)를 보면 히스토그램의 분포는 대칭적이지 않고 약간 왼쪽으로 치우쳐 있는 것으로 보입니다. 이는 왼쪽으로 꼬리가 긴 왼쪽 왜도를 나타냅니다. 

좀 더 데이터의 치우침을 시각화하려면 확률 밀도 그래프를 그리면 됩니다.

```r
# 확률밀도 히스토그램
hist(ahot, breaks=seq(10,40,by=1), col="grey",border="white", 
     prob=TRUE, ylin=c(0,0.3))
     
-> prob=TRUE 옵션을 썼기 때문에 y축이 빈도수가 아니라 확률입니다.      

# 확률 밀도 히스토그램 그래프에 확률 밀도 그래프 라인 그리기
lines(density(ahot), col='red')
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/9c8b2043-cdf0-4067-aa11-fa73350a5b4e/Untitled.png)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/8cfe8db3-2211-420c-859b-5bb7f35b3b6e/Untitled.png)

### ※ 확률밀도 히스토그램 그래프에서 확률밀도라는게 무엇인가 ?

확률밀도(probability density)는 연속형 확률변수의 분포를 나타내는 함수 

확률밀도함수는 특정 값이 아니라 특정 구간에 속하는 확률변수를 설명합니다. 

(표본(일부 데이터)으로 우리라나 초등학교 학생들의 키를 추정함. 다 전수조사 못하니까. 빈도수를 구해서 00구간에 데이터가 분포될 확률로 나타내줌  

```r
정리하면 . . 
# 데이터 불러오기 
weather <- read.csv('weather.csv',header=T, fileEncoding='euc-kr')

# 확률밀도 히스토그램
hist(ahot, breaks=seq(10,40,by=1), col="grey",border="white", 
     prob=TRUE, ylin=c(0,0.3))
     
# 확률 밀도 히스토그램 그래프에 확률 밀도 그래프 라인 그리기
lines(density(ahot), col='red')
```

문제111. 중고차의 가격 데이터의 분포를 분석하기 쉽도록 히스토그램 그래프를 그리시오 

```r
cars<- read.csv('usedcars.csv',header=T)
cars

c_price<- cars[ , c('price')]
c_price

max(cars$price) #21992
min(cars$price) #3800

hist(c_price, breaks=seq(0,26000,by=1000),col="grey",border="white", 
     prob=TRUE, ylin=c(0,0.0002))

lines( density(c_price), 
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/c98ac741-0b57-4e4b-a452-0777051b37cc/Untitled.png)

그래프 해석 : 대부분의 중고차 가격이 약 10,000 달러에서 15,000달러 사이에 집중되어 있습니다. 가격의 분포는 오른쪽으로 긴 꼬리를 가진 비대칭 형태를 보입니다. 이는 중고차의 가격이 낮은 가격대에 집중되어 있으며, 고가의 중고차는 상대적으로 적음을 의미합니다. 

### 📍문법2. plotly_중고차 가격 데이터

```r
# plotly 패키지 로드
library(plotly)

# 데이터 로드
data <- read.csv("usedcars.csv")

# plotly를 사용한 히스토그램 생성
fig <- plot_ly(data, x = ~price, type = 'histogram', marker = list(color = 'blue'))

# 그래프 레이아웃 설정
fig <- fig %>%
  layout(title = 'Histogram of Used Car Prices',
         xaxis = list(title = 'Price'),
         yaxis = list(title = 'Count'))

# 그래프 출력
fig
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/54607ac3-924b-48ee-a25e-faa15dd49dee/Untitled.png)

### 📍문법3. plotly_y축이 빈도수가 아니라 확률로 출력 되게 해서 시각화 하시오 !

```r
# plotly 패키지 로드
library(plotly)

# 데이터 로드
data <- read.csv("usedcars.csv")

# plotly를 사용한 히스토그램 생성
fig <- plot_ly(data, x = ~price, type = 'histogram', marker = list(color = 'blue'), 
                  **histnorm = 'probability'**)

# 그래프 레이아웃 설정
fig <- fig %>%
  layout(title = 'Probability Histogram of Used Car Prices',
         xaxis = list(title = 'Price'),
         yaxis = list(title = 'Probability'))

# 그래프 출력
fig
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/800a4c7f-12bf-4a0a-9a9b-1cd9ca7fd647/Untitled.png)

[오늘의 마지막 문제] 

오늘 그린 그래프들을 이용해서 SQL포트폴리오 데이터를 이용해서 시각화를 하시오 ! 

```r
# plotly를 사용한 물건금액 히스토그램 생성
fig <- plot_ly(house, x = ~물건금액, type = 'histogram', 
								marker = list(color = 'grey')
                )

fig
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/ea7510f6-6de0-4a10-a300-257b51913324/Untitled.png)

```r
 - 가격 ~ 층 산포도 그래프

# 데이터 불러오기
library(plotly)
setwd("c:\\data")
usedcars<- read.csv("usedcars.csv",header=T)

# 산포도 그래프 생성
fig<- plot_ly( data= usedcars, 
								x= ~mileage,
								y= ~price, 
								type= 'scatter', 
								mode= 'markers',
								markers=list(color='blue'))
								
fig								

#추세선 추가
house$건물층<- ifelse (is.na(house$층),1,$층)

fig <- fig %>% add_trace ( x = house$건물층,
                           y = fitted ( lm ( 물건금액 ~ 건물층, data = house) ),
                           type = 'scatter',
                           mode = 'lines',
                           line = list(color = 'red'),
                           name = 'Trend Line') 
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/08691aea-b5b9-4275-80cd-5d0d824962f4/f5cc6a92-f75a-4e93-995a-a20afc136d30/Untitled.png)